%{
Karol Wadolowski
Returns the generator and pparity check matrices for the rate 1/2 code
specified by the 802.11 standard for sublock size 27 and n = 648.
%}

function [H,A,B,T,C,D,E] = ldpcCode()
    H = sparse(324,648);
    z = 27;                 %Subblock size
    I = speye(z);
    
    pattern = [ 0, -1, -1, -1,  0,  0, -1, -1,  0, -1, -1,  0,  1,  0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1;
               22,  0, -1, -1, 17, -1,  0,  0, 12, -1, -1, -1, -1,  0,  0, -1, -1, -1, -1, -1, -1, -1, -1, -1;
                6, -1,  0, -1, 10, -1, -1, -1, 24, -1,  0, -1, -1, -1,  0,  0, -1, -1, -1, -1, -1, -1, -1, -1;
                2, -1, -1,  0, 20, -1, -1, -1, 25,  0, -1, -1, -1, -1, -1,  0,  0, -1, -1, -1, -1, -1, -1, -1;
               23, -1, -1, -1,  3, -1, -1, -1,  0, -1,  9, 11, -1, -1, -1, -1,  0,  0, -1, -1, -1, -1, -1, -1;
               24, -1, 23,  1, 17, -1,  3, -1, 10, -1, -1, -1, -1, -1, -1, -1, -1,  0,  0, -1, -1, -1, -1, -1;
               25, -1, -1, -1,  8, -1, -1, -1,  7, 18, -1, -1,  0, -1, -1, -1, -1, -1,  0,  0, -1, -1, -1, -1;
               13, 24, -1, -1,  0, -1,  8, -1,  6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  0,  0, -1, -1, -1;
                7, 20, -1, 16, 22, 10, -1, -1, 23, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  0,  0, -1, -1;
               11, -1, -1, -1, 19, -1, -1, -1, 13, -1,  3, 17, -1, -1, -1, -1, -1, -1, -1, -1, -1,  0,  0, -1;
               25, -1,  8, -1, 23, 18, -1, 14,  9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  0,  0;
                3, -1, -1, -1, 16, -1, -1,  2, 25,  5, -1, -1,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  0];
    
    %Fill in H properly based on pattern
    for ii = 1:size(pattern,1)
        for jj = 1:size(pattern,2)
            indr = ((ii-1)*z+1):(ii*z);     %Row indices
            indc = ((jj-1)*z+1):(jj*z);     %Column indices
            
            if pattern(ii,jj) ~= -1
                temp = sparse(z,z);
                for kk = 1:z
                    ind = mod((1:27)-1+pattern(ii,jj),z)+1;
                    temp(kk,ind) = I(kk,:);
                end
                H(indr,indc) = temp;
            end
        end
    end
    
    %Richardson Urbanke Matrices
    A = H(1:297,1:324);
    B = H(1:297,325:351);
    T = H(1:297,352:648);
    C = H(298:324,1:324);
    D = H(298:324,325:351);
    E = H(298:324,352:648);
end